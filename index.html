<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tetris</title>
</head>
<body>
  <canvas id="canvas" width="500" height="500"></canvas>

  <script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var blocks = [];

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (var i = 0; i < blocks.length; i++) {
        var block = blocks[i];

        ctx.fillStyle = block.color;
        ctx.fillRect(block.x, block.y, block.width, block.height);
      }
    }

    function generateBlock() {
      var block = {
        x: 0,
        y: 0,
        width: 20,
        height: 20,
        color: "random"
      };

      var x = Math.floor(Math.random() * (canvas.width - block.width));
      var y = 0;

      while (y < canvas.height - block.height) {
        if (checkCollision(block, x, y)) {
          break;
        }

        y++;
      }

      block.x = x;
      block.y = y;

      blocks.push(block);
    }

    function checkCollision(block, x, y) {
      for (var i = 0; i < blocks.length; i++) {
        if (i === blocks.indexOf(block)) {
          continue;
        }

        var otherBlock = blocks[i];

        if (x === otherBlock.x && y === otherBlock.y) {
          return true;
        }
      }

      return false;
    }

    function moveBlock(direction) {
      var block = blocks[blocks.length - 1];

      switch (direction) {
        case "left":
          block.x--;
          break;
        case "right":
          block.x++;
          break;
        case "down":
          block.y++;
          break;
      }

      if (checkCollision(block, block.x, block.y)) {
        block.y--;
      }
    }

    window.addEventListener("keydown", function(event) {
      switch (event.keyCode) {
        case 37:
          moveBlock("left");
          break;
        case 38:
          // do nothing
          break;
        case 39:
          moveBlock("right");
          break;
        case 40:
          moveBlock("down");
          break;
      }
    });

    setInterval(generateBlock, 1000);
    setInterval(draw, 20);
  </script>
</body>
</html>
